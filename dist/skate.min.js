/*! skate 2015-08-21 */
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(process,Buffer){(function(global,factory){"use strict";if(typeof define==="function"&&!!define.amd){define(factory)}else if(typeof exports==="object"){module.exports=factory()}else{global.deepcopy=factory()}})(this,function(){"use strict";var isNode,util,isBuffer,getKeys,getSymbols,indexOfArray;isNode=typeof process!=="undefined"&&typeof require!=="undefined";util=isNode?require("util"):function(){function isArray(value){return typeof value==="object"&&Object.prototype.toString.call(value)==="[object Array]"}function isDate(value){return typeof value==="object"&&Object.prototype.toString.call(value)==="[object Date]"}function isRegExp(value){return typeof value==="object"&&Object.prototype.toString.call(value)==="[object RegExp]"}function isSymbol(value){return typeof value==="symbol"}return{isArray:typeof Array.isArray==="function"?function(obj){return Array.isArray(obj)}:isArray,isDate:isDate,isRegExp:isRegExp,isSymbol:typeof Symbol==="function"?isSymbol:function(){return false}}}();isBuffer=isNode?function(obj){return Buffer.isBuffer(obj)}:function(){return false};getKeys=typeof Object.keys==="function"?function(obj){return Object.keys(obj)}:function(obj){var keys=[],key;if(obj===null||typeof obj!=="object"){throw new TypeError("obj is not an Object")}for(key in obj){obj.hasOwnProperty(key)&&keys.push(key)}return keys};getSymbols=typeof Symbol==="function"?function(obj){return Object.getOwnPropertySymbols(obj)}:function(){return[]};indexOfArray=typeof Array.prototype.indexOf==="function"?function(array,searchElement){return array.indexOf(searchElement)}:function(array,searchElement){var i,len;if(!util.isArray(array)){throw new TypeError("array is not an Array")}for(i=0,len=array.length;i<len;++i){if(array[i]===searchElement){return i}}return-1};function copyValue_(value,clone,visited,reference){var str,pos,buf,keys,i,len,key,val,idx,obj,ref;if(value===null||typeof value!=="object"){return value}if(util.isDate(value)){return new Date(+value)}if(util.isRegExp(value)){str=String(value);pos=str.lastIndexOf("/");return new RegExp(str.slice(1,pos),str.slice(pos+1))}if(isBuffer(value)){buf=new Buffer(value.length);value.copy(buf);return buf}keys=getKeys(value).concat(getSymbols(value));for(i=0,len=keys.length;i<len;++i){key=keys[i];val=value[key];if(val!==null&&typeof val==="object"){idx=indexOfArray(visited,val);if(idx===-1){obj=util.isArray(val)?[]:{};visited.push(val);reference.push(obj)}else{ref=reference[idx]}}clone[key]=ref||copyValue_(val,obj,visited,reference)}return clone}function deepcopy(value){var clone=util.isArray(value)?[]:{},visited=[value],reference=[clone];return copyValue_(value,clone,visited,reference)}return deepcopy})}).call(this,require("_process"),require("buffer").Buffer)},{_process:8,buffer:3,util:10}],2:[function(require,module,exports){function Generator(cb){var self=this;self._registeredEmits=[];self._registeredCatches=[];self._registeredDones=[];var callback=function(fns,args){for(var i=0,max=fns.length;i<max;++i){fns[i].apply(null,args)}};var done=function(){setTimeout(function(){callback(self._registeredDones,[])},1)};var reject=function(error){setTimeout(function(){callback(self._registeredCatches,[error])},1)};var emit=function(item,cancel){setTimeout(function(){callback(self._registeredEmits,[item,cancel])},1)};if(cb.constructor.name=="GeneratorFunction"){cb=cb()}if(cb.constructor.name=="GeneratorFunctionPrototype"){var item;var cancelled=false;while(!cancelled&&!(item=cb.next()).done){emit(item.value,function(){cancelled=true})}done();return}if(cb.constructor.name=="Array"){var items=cb;var position=0;var cancelled=false;for(var i=0,max=items.length;i<max;++i){emit(items[i],function(){cancelled=true})}done();return}if(cb.constructor.name=="Promise"){cb.then(function(result){emit(result,function(){});done()});return}cb(done,reject,emit)}if(typeof window!=="undefined")window.Generator=Generator;if(typeof module!=="undefined")module.exports=Generator;Generator.InvalidResolution={error:"streamablePromise-invalid-resolution",message:"You cannot resolve() a Generator with a value. "+"The Promise value of a generator is always an array of yielded items"};Generator.InvalidSubpromiseResolution={error:"streamablePromise-invalid-subresolution",message:"While attempting to combine the results of multiple promises, "+"one of the promises returned an item which was not an array."};Generator.resolve=function(value){return new Generator(function(done,reject,emit){emit(value);done()})};Generator.splitPromise=function(promise){return new Generator(function(done,reject,emit){promise.then(function(result){for(var i=0,max=result.length;i<max;++i)emit(result[i]);done()})})};Generator.union=function(generators){return new Generator(function(done,reject,emit){var promises=[];for(var i=0,max=generators.length;i<max;++i){var generator=generators[i];if(generator.emit){generator.emit(function(item){emit(item)});promises.push(generator.done())}else{Console.log("WARNING: Passing promises directly to Generator.union() is deprecated. Please wrap the promise in a Generator first.");promises.push(generator.then(function(items){if(typeof items!=="object"||items.length===undefined){throw Generator.InvalidSubpromiseResolution}for(var j=0,jMax=items.length;j<jMax;++j){emit(items[j])}}))}}Promise.all(promises).then(function(){done()})})};Generator.exclude=function(setA,setB,comparator){if(comparator===undefined){comparator=function(a,b){return a===b}}return new Generator(function(resolve,reject,emit){var itemsA=[];var itemsB=[];Promise.all([setA.then(function(items){itemsA=items}),setB.then(function(items){itemsB=items})]).then(function(){for(var i=0,max=itemsA.length;i<max;++i){var itemA=itemsA[i];var skip=false;for(var j=0,jMax=itemsB.length;j<jMax;++j){var itemB=itemsB[j];if(comparator(itemA,itemB)){skip=true;break}}if(skip)continue;emit(itemA)}resolve()})})};Generator.intersectByHash=function(generators,hasher){return new Generator(function(resolve,reject,emit){var map={};var handlers=[];for(var i=0,max=generators.length;i<max;++i){var generator=generators[i];var handleEmit=function(item){var id=hasher(item);var count=0;if(map[id])count=map[id];count+=1;map[id]=count;if(count==generators.length){emit(item)}};if(generator.emit){handlers.push(new Promise(function(resolve,reject){generator.emit(handleEmit).done(function(){resolve()})}))}else{console.log("WARNING: Passing promises to Generator.intersectByHash() is deprecated. Please wrap it in a Generator first.");handlers.push(generator.then(function(items){for(var j=0,jMax=items.length;j<jMax;++j){handleEmit(items[j])}}))}}Promise.all(handlers).then(function(){resolve()})})};Generator.intersectByComparison=function(generators,comparator){return new Generator(function(resolve,reject,emit){var handlers=[];var distinctItems=[];for(var i=0,max=generators.length;i<max;++i){var generator=generators[i];var handleEmit=function(item){var found=false;for(var j=0,jMax=distinctItems.length;j<jMax;++j){var distinctItem=distinctItems[j];if(comparator(distinctItem.item,item)){distinctItem.count+=1;if(!distinctItem.emitted&&distinctItem.count==generators.length){distinctItem.emitted=true;emit(distinctItem.item)}found=true;break}}if(found)return;var distinctItem={item:item,count:1,emitted:false};if(distinctItem.count==generators.length){emit(distinctItem.item);distinctItem.emitted=true}distinctItems.push(distinctItem)};if(generator.emit){handlers.push(new Promise(function(resolve,reject){generator.emit(handleEmit).then(function(){resolve()})}))}else{handlers.push(generator.then(function(items){for(var j=0,jMax=items.length;j<jMax;++j){handleEmit(items[j])}}))}}Promise.all(handlers).then(function(){resolve()})})};Generator.prototype.emit=function(cb){if(!cb){var self=this;return new Promise(function(resolve,reject){var handler;self.emit(handler=function(item){resolve(item)})})}this._registeredEmits.push(cb);return this};Generator.prototype.deregister=function(event,cb){var map={emit:this._registeredEmits,"catch":this._registeredCatches,done:this._registeredDones};if(map[event].indexOf(cb)>=0)map[event].splice(map[event].indexOf(cb),1)};Generator.prototype.catch=function(cb){if(!cb){var self=this;return new Promise(function(resolve){self.catch(function(err){resolve(err)})})}this._registeredCatches.push(cb);return this};Generator.prototype.done=function(cb){if(!cb){var self=this;return new Promise(function(resolve,reject){self.done(function(){resolve()}).catch(function(err){reject(err)})})}this._registeredDones.push(cb);return this};Generator.prototype.then=function(cb){var self=this;return new Promise(function(resolve,reject){var items=[];self.emit(function(item){items.push(item)}).done(function(){try{var result=cb(items);resolve(result)}catch(e){reject(e)}})})}},{}],3:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){function Foo(){}try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};arr.constructor=Foo;return arr.foo()===42&&arr.constructor===Foo&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){if(!(this instanceof Buffer)){if(arguments.length>1)return new Buffer(arg,arguments[1]);return new Buffer(arg)}this.length=0;this.parent=undefined;if(typeof arg==="number"){return fromNumber(this,arg)}if(typeof arg==="string"){return fromString(this,arg,arguments.length>1?arguments[1]:"utf8")}return fromObject(this,arg)}function fromNumber(that,length){that=allocate(that,length<0?0:checked(length)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<length;i++){that[i]=0}}return that}function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding==="")encoding="utf8";var length=byteLength(string,encoding)|0;that=allocate(that,length);that.write(string,encoding);return that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(object==null){throw new TypeError("must start with number, buffer, array or string")}if(typeof ArrayBuffer!=="undefined"&&object.buffer instanceof ArrayBuffer){return fromTypedArray(that,object)}if(object.length)return fromArrayLike(that,object);return fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=checked(buffer.length)|0;that=allocate(that,length);buffer.copy(that,0,0,length);return that}function fromArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromTypedArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromJsonObject(that,object){var array;var length=0;if(object.type==="Buffer"&&isArray(object.data)){array=object.data;length=checked(array.length)|0}that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function allocate(that,length){if(Buffer.TYPED_ARRAY_SUPPORT){that=Buffer._augment(new Uint8Array(length))}else{that.length=length;that._isBuffer=true}var fromPool=length!==0&&length<=Buffer.poolSize>>>1;if(fromPool)that.parent=rootParent;return that}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;var i=0;var len=Math.min(x,y);while(i<len){if(a[i]!==b[i])break;++i}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(length===undefined){length=0;for(i=0;i<list.length;i++){length+=list[i].length}}var buf=new Buffer(length);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function byteLength(string,encoding){if(typeof string!=="string")string=""+string;var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;function slowToString(encoding,start,end){var loweredCase=false;start=start|0;end=end===undefined||end===Infinity?this.length:end|0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return 0;return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.get=function get(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function set(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length|0;length=swap}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){
for(var i=0;i<len;i++){target[i+targetStart]=this[i+start]}}else{target._set(this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function toArrayBuffer(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function _augment(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.indexOf=BP.indexOf;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];var i=0;for(;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(leadSurrogate){if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}else{codePoint=leadSurrogate-55296<<10|codePoint-56320|65536;leadSurrogate=null}}else{if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}else{leadSurrogate=codePoint;continue}}}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null}if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<2097152){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":4,ieee754:5,"is-array":6}],4:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],5:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],6:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],7:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],8:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){currentQueue[queueIndex].run()}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],9:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],10:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":9,_process:8,inherits:7}],11:[function(require,module,exports){var transact=require("./transact.js");var Repository=require("./Repository.js");function Database(schema,idb){if(!schema)throw"Must pass a SchemaBuilder as 'schema' to the skate.Database constructor";this._schema=schema;this._idb=idb;this._repositoryConfigs={};this._transact=transact}module.exports=Database;Database.prototype.transact=function(mode,fn){if(typeof mode!=="string"){throw"First parameter must be a mode string"}var self=this;return transact(this,null,function(db,name,transaction){return self.repository(name,transaction)},fn,mode)};Database.prototype.setIDB=function(idb){this._idb=idb};Database.prototype.repository=function(name,tx){var repo=new Repository(this.idb(),name,tx);this.prepareRepository(repo);return repo};Database.prototype.prepareRepository=function(repository){if(this._repositoryConfigs[repository.storeName])this._repositoryConfigs[repository.storeName](repository)};Database.prototype.configRepository=function(name,cb){if(this._repositoryConfigs[name]){var original=this._repositoryConfigs[name];this._repositoryConfigs[name]=function(repo){original(repo);cb(repo)}}else{this._repositoryConfigs[name]=cb}};Database.prototype.getSchema=function(){return this._schema};Database.prototype.idb=function(){return this._idb}},{"./Repository.js":14,"./transact.js":20}],12:[function(require,module,exports){function IDBCursorGenerator(cursor){var request=cursor;var cancelled=false;return new Generator(function(done,reject,emit){request.onsuccess=function(ev){if(!ev.target)return;var cursor=ev.target.result;if(!cursor){done();return}if(!cancelled){emit(cursor.value,function(){cancelled=true})}if(cancelled){done();return}if(!cursor.continue)throw"ev is "+ev.target.result;cursor.continue()};request.onerror=function(ev){reject(ev)}})}if(typeof window!=="undefined"){window.SkateIDBCursorGenerator=IDBCursorGenerator}module.exports=IDBCursorGenerator},{}],13:[function(require,module,exports){function IDBRequestGenerator(request){var cancelled=false;return new Generator(function(done,reject,emit){request.onsuccess=function(ev){if(!ev.target)return;var result=ev.target.result;emit(result);done()};request.onerror=function(ev){reject(ev)}})}if(typeof window!=="undefined"){window.SkateIDBRequestGenerator=IDBRequestGenerator}module.exports=IDBRequestGenerator},{}],14:[function(require,module,exports){var stripCopy=require("./stripCopy.js");var Generator=require("es5-generators");var IDBRequestGenerator=require("./IDBRequestGenerator.js");var IDBCursorGenerator=require("./IDBCursorGenerator.js");function Repository(db,storeName,transaction){var self=this;if(db instanceof Promise){this.ready=db}else{this.ready=Promise.resolve(db)}this.storeName=storeName;this.transaction=transaction?transaction:null}module.exports=Repository;if(typeof window!=="undefined")window.SkateRepository=Repository;Repository.prototype.dehydrate=function(item){};Repository.prototype.hydrate=function(item){return Promise.resolve(item)};Repository.prototype.getStoreTransaction=function(idb){if(this.transaction)return this.transaction;return idb.transaction([this.storeName],"readwrite")};Repository.prototype._hydrateItem=function(db,item){var self=this;var schema=db.getSchema();var store=schema.getStore(self.storeName);var foreignFields=store.getForeignFields();return db._transact(db,null,function(db,name,transaction){return db.repository(name,transaction)},self.hydrate,"readonly",{item:item})};Repository.prototype._dehydrateItem=function(db,item){this.dehydrate(db,item);return item};Repository.generateGuid=function(){var result,i,j;result="";for(j=0;j<32;j++){if(j==8||j==12||j==16||j==20)result=result+"-";i=Math.floor(Math.random()*16).toString(16).toUpperCase();result=result+i}return result};Repository.prototype.generateGuid=Repository.generateGuid;Repository.prototype.setTransaction=function(tx){this.transaction=tx};Repository.prototype.getStore=function(){if(!this.transaction){throw"Cannot get object store for a non-transaction repository"}return};Repository.prototype.stripCopy=function(item){return stripCopy(item)};Repository.prototype.persist=function(item){var self=this;item=stripCopy(item);return new Promise(function(resolve,reject){self.ready.then(function(db){var clone=self.stripCopy(item);self._dehydrateItem(db,clone);var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);new IDBRequestGenerator(store.put(clone,clone.id)).done(function(){resolve()}).catch(function(err){reject(err)})})})};Repository.prototype.hydrateCursor=function(cursor){return this.hydrateGenerator(new IDBCursorGenerator(cursor))};Repository.prototype.hydrateGenerator=function(generator){var self=this;return new Generator(function(done,reject,emit){self.ready.then(function(db){generator.emit(function(item){self._hydrateItem(db,item).then(function(hydratedItem){emit(hydratedItem)})});generator.done(function(){done()});generator.catch(function(err){reject(err)})})})};Repository.prototype.get=function(id){var self=this;return self.ready.then(function(db){return new Promise(function(resolve,reject){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);self.hydrateCursor(store.get(id)).emit(function(hydratedItem){resolve(hydratedItem)})})})};Repository.prototype.all=function(){var self=this;return new Generator(function(done,reject,emit){self.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var cursor=self.hydrateCursor(store.openCursor());cursor.emit(function(item){emit(item)}).done(function(){done()})})})};Repository.prototype.index=function(name){var repo=this;return{name:name,count:function(){var self=this;return new Promise(function(resolve,reject){repo.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var index=store.index(self.name);new IDBRequestGenerator(index.count()).emit(function(count){resolve(count)})})})},get:function(key){var self=this;return new Promise(function(resolve,reject){repo.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var index=store.index(self.name);new IDBRequestGenerator(index.get(key)).emit(function(item){resolve(item)})})})},getKey:function(key){var self=this;return new Promise(function(resolve,reject){repo.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var index=store.index(self.name);new IDBRequestGenerator(index.getKey(key)).emit(function(item){resolve(item)})})})},cursor:function(range){var self=this;return new Generator(function(done,reject,emit){repo.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var index=store.index(self.name);self.hydrateCursor(index.openCursor(range)).emit(function(item,cancel){emit(item,cancel)}).catch(function(err){reject(err)}).done(function(){done()})})})},keyCursor:function(range){var self=this;return new Generator(function(done,reject,emit){repo.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var index=store.index(self.name);self.hydrateCursor(index.openKeyCursor(range)).emit(function(item,cancel){emit(item,cancel)}).catch(function(err){reject(err)}).done(function(){done()})})})}}};Repository.prototype.cursor=function(range){var self=this;return new Generator(function(done,reject,emit){self.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);self.hydrateCursor(store.openCursor(range)).emit(function(item,cancel){emit(item,cancel)}).catch(function(err){reject(err)}).done(function(){done()})})})};Repository.prototype.getMany=function(ids,includeNulls){var self=this;return new Generator(function(done,reject,emit){self.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var itemPromises=[];for(var i=0,max=ids.length;i<max;++i){var id=ids[i];!function(){itemPromises.push(new Promise(function(resolve,reject){self.hydrateCursor(store.get(id)).emit(function(item){emit(item);resolve(item)}).catch(function(err){if(includeNulls){emit(null)}resolve(null)})}).then(function(items){return items}))}(id)}Promise.all(itemPromises).then(function(items){done()})})})};Repository.prototype.find=function(criteria){var self=this;return new Generator(function(resolve,reject,emit){self.ready.then(function(db){var isEquivalent;isEquivalent=function(criteriaValue,realValue){if(criteriaValue===realValue)return true;if(criteriaValue==realValue)return true;if(typeof criteriaValue=="object"){var good=true;for(var key in criteriaValue){var value=criteriaValue[key];if(!isEquivalent(criteriaValue[key],realValue[key])){good=false;break}}return good}return false};var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);var items=null;var promise=Promise.resolve();for(var fieldName in criteria){!function(fieldName){promise=promise.then(function(){var fieldValue=criteria[fieldName];if(items===null){if(store.indexNames.contains(fieldName)){var index=store.index(fieldName);return new Promise(function(resolve,reject){items=[];new IDBCursorGenerator(index.openCursor(fieldValue)).emit(function(item){items.push(item)}).done(function(){resolve()})})}else{return new Promise(function(resolve,reject){items=[];new IDBCursorGenerator(store.openCursor()).emit(function(item){items.push(item)}).done(function(){resolve()})})}}else{var newItems=[];for(var i=0,max=items.length;i<max;++i){var item=items[i];if(!isEquivalent(fieldValue,item[fieldName]))continue;newItems.push(item)}items=newItems}})}(fieldName)}promise.then(function(){for(var i=0,max=items.length;i<max;++i)emit(items[i]);resolve()})})})};Repository.prototype.delete=function(id){var self=this;return new Promise(function(resolve,reject){self.ready.then(function(db){var tx=self.getStoreTransaction(db);var store=tx.objectStore(self.storeName);store.delete(id);new IDBRequestGenerator(store.delete(id)).done(function(){resolve()})})})}},{"./IDBCursorGenerator.js":12,"./IDBRequestGenerator.js":13,"./stripCopy.js":19,"es5-generators":2}],15:[function(require,module,exports){var transact=require("./transact.js");var StoreBuilder=require("./StoreBuilder.js");function SchemaBuilder(name,registry){this.name=name;this.stores={};this.registry=registry}module.exports=SchemaBuilder;SchemaBuilder.prototype.setDatabase=function(db,transaction){this.db=db;this.transaction=transaction};SchemaBuilder.prototype.isLive=function(){return this.transaction&&this.db};SchemaBuilder.prototype.disconnectDatabase=function(){this.transaction=null;this.db=null};SchemaBuilder.prototype.createStore=function(name){if(this.stores[name]){throw"store-already-exists: A store with name '"+name+"' already exists."}return new StoreBuilder(this,name)};SchemaBuilder.prototype.getStore=function(name){if(!this.stores[name]){throw"no-such-store: A store with name '"+name+"' could not be found."}return this.stores[name]};SchemaBuilder.prototype.run=function(callback){if(this.transaction&&this.db){var metadata=annotateFn(callback);var fn=metadata.fn;var params=metadata.params;var self=this;transact(this.db,this.transaction,function(db,name,tx){var repo=new Repository(db,name,tx);registry.prepareRepository(repo);return repo},fn,"readwrite")}return this};SchemaBuilder.prototype.debug=function(){console.log("Schema for database "+this.name);for(var name in this.stores){var store=this.stores[name];console.log("store "+name);console.log("- pkey: "+store.store.primaryKey);for(var fieldName in store.store.fields){var field=store.store.fields[fieldName];console.log(" - "+fieldName)}}}},{"./StoreBuilder.js":16,"./transact.js":20}],16:[function(require,module,exports){function StoreBuilder(builder,name,id){this.builder=builder;this.store={primaryKey:id,name:name,fields:{}};if(builder){this.builder.stores[name]=this;if(this.builder.transaction&&this.builder.db){
this.store.realized=this.builder.db.createObjectStore(name,{keyPath:id})}}}module.exports=StoreBuilder;StoreBuilder.prototype.run=function(callback){if(this.builder)return this.builder.run(callback)};StoreBuilder.prototype.getForeignFields=function(){var items=[];for(var i=0,max=this.store.fields.length;i<max;++i){var field=this.store.fields[i];if(field.references){items.add(field)}}return items};StoreBuilder.prototype.getOneToManyFields=function(){var items=[];for(var i=0,max=this.store.fields.length;i<max;++i){var field=this.store.fields[i];if(field.references){items.add(field)}}return items};StoreBuilder.prototype.createStore=function(name){if(!this.builder){throw{type:"NoBuilderToCreateStoreOn",message:"Cannot start a new store definition without an attached SchemaBuilder (storeBuilder.store())"}}return this.builder.createStore(name)};StoreBuilder.prototype.getStore=function(name){if(!this.builder){throw{type:"NoBuilderToGetStoreOn",message:"Cannot start a new store definition without an attached SchemaBuilder (storeBuilder.store())"}}return this.builder.getStore(name)};StoreBuilder.prototype.getField=function(name){if(!this.store.fields[name]){throw{error:"NoSuchField",message:"The field "+name+" does not exist"}}return this.store.fields[name]};StoreBuilder.prototype.key=function(name){this.addField(name,{key:true,index:name,name:name,unique:false});return this};StoreBuilder.prototype.field=function(name){this.addField(name,{key:false,index:name,name:name,unique:false});return this};StoreBuilder.prototype.addField=function(name,data){if(this.store.fields[name]){throw{error:"FieldAlreadyExists",message:"The field "+name+" already exists"}}this.store.fields[name]=data;if(data.key&&this.builder&&this.builder.transaction){if(!this.store.realized)this.store.realized=this.builder.transaction.objectStore(this.store.name);this.store.realized.createIndex(data.index,data.name,{unique:data.unique})}return this};StoreBuilder.prototype.remove=function(name){this.removeField(name);return this};StoreBuilder.prototype.removeField=function(name){delete this.store.fields[name];if(this.builder&&this.builder.transaction){if(!this.store.realized)this.store.realized=this.builder.transaction.objectStore(this.name);this.store.realized.deleteIndex(name)}return this};StoreBuilder.prototype.id=function(name){this.addField(name,{key:true,index:name,name:name,unique:true});return this};StoreBuilder.prototype.foreign=function(name,ref){this.addField(name,{key:true,index:name,name:name,unique:false,references:ref,referenceType:"foreign"});return this};StoreBuilder.prototype.oneToMany=function(name,ref){this.addField(name,{key:true,index:name,name:name,unique:false,references:ref,referenceType:"oneToMany"});return this};StoreBuilder.prototype.manyToMany=function(name,ref){this.addField(name,{key:true,index:name,name:name,unique:false,references:ref,referenceType:"manyToMany"});return this};StoreBuilder.prototype.unique=function(name){this.addField(name,{key:true,index:name,name:name,unique:true});return this}},{}],17:[function(require,module,exports){if(typeof window!=="undefined"){window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}},{}],18:[function(require,module,exports){require("./idbStandardize.js");var SchemaBuilder=require("./SchemaBuilder.js");var StoreBuilder=require("./StoreBuilder.js");var Repository=require("./Repository.js");var transact=require("./transact.js");var Generator=require("es5-generators");var Database=require("./Database.js");var skate={version:"0.1",repository:function(db,storeName){return new Repository(db,storeName)},open:function(indexedDB,dbName,options){var version=1;if(options.version)version=options.version;var resolveReady;var rejectReady;var ready=new Promise(function(resolve,reject){resolveReady=resolve;rejectReady=reject});var schema=new SchemaBuilder(dbName,this);var db=new Database(schema,null);var migrated=false;var DBOpenRequest=indexedDB.open(dbName,version);DBOpenRequest.onerror=function(event){rejectReady()};DBOpenRequest.onsuccess=function(event){var idb=event.target.result;db.setIDB(idb);if(!migrated&&options.migrations){for(var v=1;v<=version;++v){options.migrations[v](schema)}}resolveReady(db)};DBOpenRequest.onupgradeneeded=function(event){migrated=true;var idb=event.target.result;db.setIDB(idb);schema.setDatabase(db,null);var oldVersion=event.oldVersion;var newVersion=event.newVersion;if(!options.migrations){throw"Cowardly refusing to upgrade when no migrations are specified."}for(var version=1;version<=oldVersion;++version){if(options.migrations[version])options.migrations[version](schema)}schema.setDatabase(db,event.currentTarget.transaction);idb.onerror=function(event){console.error("[skate] Error while building database schema");console.log(event)};for(var version=oldVersion+1;version<=newVersion;++version){options.migrations[version](schema)}schema.disconnectDatabase();idb.onerror=null};return ready}};module.exports=skate},{"./Database.js":11,"./Repository.js":14,"./SchemaBuilder.js":15,"./StoreBuilder.js":16,"./idbStandardize.js":17,"./transact.js":20,"es5-generators":2}],19:[function(require,module,exports){var deepcopy=require("deepcopy");function strip(obj){if(obj===null)return;if(typeof obj!=="object")return;if(obj.length){for(var i=0,max=obj.length;i<max;++i){strip(obj[i])}}else{for(var key in obj){if(key=="")continue;if(key[0]=="$")delete obj[key];else strip(obj[key])}}}function stripCopy(obj){var copy;copy=deepcopy(obj);strip(obj);return obj}module.exports=stripCopy},{deepcopy:1}],20:[function(require,module,exports){var injector=require("./utils/lightinjector.js");var Repository=require("./Repository.js");function SkateUnknownStoreException(message){this.message=message}function transact(db,transactionOrFactory,repositoryFactory,fn,mode,extraInjectables){var mode=mode||"readonly";var idb=db.idb();if(!repositoryFactory){repositoryFactory=function(db,name,tx){return new Repository(db,name,tx)}}var injectables={$db:db,$$db:db.idb(),$schema:db.getSchema(),$transact:function(){return function(mode,fn){transact(db,transactionOrFactory,repositoryFactory,fn,mode)}},$populate$:function(params){var storeNames=[];for(var i=0,max=params.length;i<max;++i){if(params[i]=="db")continue;storeNames.push(params[i])}if(transactionOrFactory==null){this.$transaction=idb.transaction(storeNames,mode)}else if(typeof transactionOrFactory==="function"){this.$transaction=transactionOrFactory(storeNames,mode)}else{this.$transaction=transactionOrFactory}var hydratedParams=[];for(var i=0,max=params.length;i<max;++i){var param=params[i];if(this[param])continue;if(param=="resolve"||param=="reject"){if(!promise){promise=new Promise(function(resolve,reject){promiseResolve=resolve;promiseReject=reject})}if(param=="resolve")this.resolve=promiseResolve;if(param=="reject")this.reject=promiseReject;continue}var storeOnly=false;var storeName=param;if(storeName.indexOf("store:")==0){storeOnly=true;storeName=storeName.replace(/^store:/,"")}var store;try{store=this.$transaction.objectStore(storeName)}catch(e){throw new SkateUnknownStoreException("No such object store "+param)}if(storeOnly){this[param]=store}else{this[param]=repositoryFactory(db,param,this.$transaction)}}}};if(extraInjectables){for(var name in extraInjectables){if(injectables[name])continue;injectables[name]=extraInjectables[name]}}var result=injector(injectables,null,fn);if(result&&result.constructor&&result.constructor.name=="Promise"){return result}return Promise.resolve(result)}module.exports=transact},{"./Repository.js":14,"./utils/lightinjector.js":22}],21:[function(require,module,exports){var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m;var FN_ARG_SPLIT=/,/;var FN_ARG=/^\s*(_?)(\S+?)\1\s*$/;var STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;function annotateFn(fn){if(typeof fn==="undefined"){return{fn:function(){},params:[]}}if(typeof fn==="object"&&fn.length!==undefined){var params=fn;fn=params[params.length-1];params.pop();return{fn:fn,params:params}}if(typeof fn==="string"){console.log("A string was passed to annotateFn()");throw"A string was passed to annotateFn()"}var $params;if(!($params=fn.$params)){$params=[];var fnText=fn.toString().replace(STRIP_COMMENTS,"");var argDecl=fnText.match(FN_ARGS);if(!argDecl){console.log("Failed to parse function declaration: "+fnText);throw"Failed to parse function declaration: "+fnText}var parts=argDecl[1].split(FN_ARG_SPLIT);for(var i=0,max=parts.length;i<max;++i){var arg=parts[i];arg.replace(FN_ARG,function(all,underscore,name){$params.push(name)})}fn.$params=$params}return{fn:fn,params:fn.$params}}module.exports=annotateFn},{}],22:[function(require,module,exports){var annotateFn=require("./annotateFn.js");function InjectionException(message){this.error="inject-error";this.message=message}function inject(map,self,fn){var meta=annotateFn(fn);var params=meta.params;fn=meta.fn;var args=[];if(map.$populate$){map.$populate$(params)}for(var i=0,max=params.length;i<max;++i){var param=params[i];var factory=map[param];if(param.match(/\$.*\$$/)){args.push(null);continue}if(typeof factory==="undefined"){if(map.$any$){factory=map.$any$}else{throw new InjectionException("No service factory for injected parameter "+param+" (Parameter must be a valid service)")}}if(typeof factory==="function"){args.push(factory(param,inject))}else{args.push(factory)}}return fn.apply(self,args)}inject.InjectionException=InjectionException;module.exports=inject},{"./annotateFn.js":21}]},{},[18]);